<!DOCTYPE html>  
<html lang="ko">  
<head>  
<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Box</title>  
  
<!-- KoPub 돋움 -->  
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-kopub@1.0/kopubdotum.min.css">  
<!-- Oswald -->  
<link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet'>  
<!-- JsBarcode -->  
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>  
  
<style>  
body {  
    margin: 0;  
    padding: 0 20px;  
    font-family: 'KoPub Dotum', sans-serif;  
    letter-spacing: -1px;  
    background: #f9f9f9;  
    font-size: 0.9rem;
}  
  
.page { padding: 20px 0; }  
  
button {  
    padding: 10px 14px;  
    border: none;  
    background: #333;  
    color: white;  
    border-radius: 6px;  
    cursor: pointer;  
    font-size: 0.8rem;  
    transform: scale(0.9);
    transform-origin: center; 
}  
button:hover { background: #000; }  
  
.page-list-header {  
    display: flex;  
    justify-content: space-between;  
    align-items: center;  
    margin-bottom: 20px;  
}  
  
.character-grid {  
    display: grid;  
    grid-template-columns: repeat(2, 1fr);  
    gap: 20px;  
}  
  
.character-card {  
    background: white;  
    border-radius: 10px;  
    padding: 10px;  
    text-align: center;  
    box-shadow: 0 2px 6px rgb(0 0 0 / 0.15);  
    cursor: pointer;  
}  
  
.character-card img {  
    width: 100%;  
    max-width: 200px;  
    height: auto;
    border-radius: 10px;  
    display: block;  
    margin: 0 auto;  
}  
  
.char-name {  
    margin-top: 8px;  
    font-size: 0.9rem;  
    text-align: center;  
}  
  
.input-box {  
    display: flex;  
    flex-direction: column;  
    margin-bottom: 15px;  
}  
  
.input-box label { margin-bottom: 4px; font-weight: bold; }  
.input-box input {  
    padding: 8px;  
    border: 1px solid #ccc;  
    border-radius: 6px;  
}  
  
#preview {  
    max-width: 200px;  
    border-radius: 10px;  
    display: block;  
    margin: 20px auto 0;  
}  
  
.register-buttons {  
    display: flex;  
    justify-content: space-between;  
    margin-top: 20px;  
}  
  
.detail-buttons {  
    display: flex;  
    justify-content: space-between;  
    margin-top: 20px;  
}  
  
.detail-img img {  
    max-width: 600px;  
    width: 100%;  
    display: block;  
    margin: 0 auto;  
    border-radius: 10px;  
}  
  
/* ★ 사원증 카드 */  
.id-card {  
    position: relative;  
    width: 100%;
    max-width: 300px;
    background: linear-gradient(135deg, #ededed, #ffffff);  
    border-radius: 15px;  
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);  
    padding: 20px;  
    color: black;  
    text-align: center;  
    margin: 0 auto 20px auto;  
}  
      
     .id-card::before {    
    content:"";    
    position:absolute;    
    top:0; left:0;    
    width:100%; height:50px;    
    background: linear-gradient(135deg, #222222, #999999);    
    border-top-left-radius:15px;    
    border-top-right-radius:15px;    
}    
  
.id-photo {  
    width: 180px;  
    height: 180px;  
    border-radius: 50%;  
    object-fit: cover;  
    margin-bottom: 16px;  
    border: 1px solid #ccc;  
}  
  
.id-name {  
    margin: 0;  
    letter-spacing: 10px;  
    font-size: 1.6rem;  
    font-weight: bold;  
}  
  
.id-code {  
    font-family: 'Oswald', monospace;  
    font-size: 1rem;  
    letter-spacing: 1px;  
    font-weight: 500;  
}  
  
#detail-barcode { margin: 0; }  
  
/* ★ 능력치 */  
.status-area {  
    margin-top: 20px;  
    display: grid;  
    grid-template-columns: repeat(2, 1fr);  
    gap: 15px 20px;  
}  
  
.stat-box { width: 100%; }  
.stat-label { font-size: 1rem; margin-bottom: 5px; }  
  
.stat-bar-bg {  
    width: 100%;  
    height: 10px;  
    background: #ddd;  
    border-radius: 6px;  
    overflow: hidden;  
}  
.stat-bar-fill {  
    width: 100%;  
    height: 100%;  
    background: #4b84ff;  
}  
#hp-bar, #str-bar, #int-bar, #cha-bar { background-color: #777777; }  
  
/* ---------------------- 팝업 ---------------------- */  
#popup {  
    position: fixed;  
    top:0; left:0;  
    width:100%; height:100%;  
    background: rgba(0,0,0,0.5);  
    display:none;  
    justify-content:center;  
    align-items:center;  
    z-index:999;  
}  
#popup-box {  
    background:white;  
    padding:20px;  
    border-radius:10px;  
    width:300px;  
    text-align:center;  
    font-size:0.9rem;  
    box-shadow:0 0 10px rgba(0,0,0,0.2);  
}  
#popup-buttons {  
    margin-top:20px;  
    display:flex;  
    gap:10px;  
    justify-content:center;  
}  
#popup-ok, #popup-cancel {  
    padding:8px 14px;  
    border-radius:6px;  
    cursor:pointer;  
}  
#popup-ok { background:#000; color:white; }  
#popup-cancel { background:#aaa; color:white; }  
</style>  
</head>  
<body>  
  
<!-- 팝업 -->  
<div id="popup">  
    <div id="popup-box">  
        <div id="popup-message"></div>  
        <div id="popup-buttons">  
            <button id="popup-ok">확인</button>  
            <button id="popup-cancel">취소</button>  
        </div>  
    </div>  
</div>  
  
<!-- 페이지 1: 사원 목록 -->  
<div id="page-list" class="page" style="display: block;">  
    <div class="page-list-header">  
        <h2>사원 목록</h2>  
        <button id="btn-register">등록</button>  
    </div>  
    <div id="characterContainer" class="character-grid"></div>  
</div>  
  
<!-- 페이지 1-1: 사원증 등록 -->  
<div id="page-register" class="page" style="display: none;">  
    <h2>사원증 발급</h2>  
    <div class="input-box">  
        <label>이미지 링크</label>  
        <input id="reg-img" placeholder="이미지 URL 입력" />  
        <img id="preview" src="" style="display:none;">  
    </div>  
    <div class="input-box">  
        <label>이름</label>  
        <input id="reg-name" placeholder="이름 입력" />  
    </div>  
    <div class="register-buttons">  
        <button onclick="goList()">이전</button>  
        <button id="btn-submit">등록</button>  
    </div>  
</div>  
  
<!-- 페이지 1-2: 상세 페이지 -->  
<div id="page-detail" class="page" style="display: none;">  
  
    <!-- 사원증 카드 -->  
    <div class="id-card">  
        <div style="margin-top:60px; margin-bottom:20px; text-align:center;">  
            <h3 class="id-name" style="font-size:40px; letter-spacing:10px; margin:0;">사원증</h3>  
        </div>  
        <img id="detail-card-img" class="id-photo" src="" alt="캐릭터 사진">  
        <div class="id-info" style="display:flex; flex-direction:column; align-items:center; text-align:center;">  
            <h3 class="id-name" id="detail-card-name" style="margin:5px 0 15px 0;">캐릭터 이름</h3>  
            <svg id="detail-barcode" width="250" height="60"></svg>  
            <div class="id-code" id="detail-card-code" style="margin:0 0 32px 0;">AB12-34CD-56EF</div>  
        </div>  
    </div>  
  
    <!-- 능력치 영역 -->  
    <div class="status-area">  
        <div class="stat-box">  
            <div class="stat-label">체력 (<span id="hp-val">10/10</span>)</div>  
            <div class="stat-bar-bg"><div class="stat-bar-fill" id="hp-bar"></div></div>  
        </div>  
        <div class="stat-box">  
            <div class="stat-label">근력 (<span id="str-val">10/10</span>)</div>  
            <div class="stat-bar-bg"><div class="stat-bar-fill" id="str-bar"></div></div>  
        </div>  
        <div class="stat-box">  
            <div class="stat-label">지능 (<span id="int-val">10/10</span>)</div>  
            <div class="stat-bar-bg"><div class="stat-bar-fill" id="int-bar"></div></div>  
        </div>  
        <div class="stat-box">  
            <div class="stat-label">매력 (<span id="cha-val">10/10</span>)</div>  
            <div class="stat-bar-bg"><div class="stat-bar-fill" id="cha-bar"></div></div>  
        </div>  
    </div>  
  
    <div class="detail-buttons">  
        <button onclick="goList()">이전</button>  
        <button id="btn-delete" style="background:#cc2222;">삭제</button>  
    </div>  
</div>  
  
<!-- Firebase SDK -->  
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>  
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>  
  
<script>  
/* ---------------- Firebase ---------------- */  
const firebaseConfig = {  
    apiKey: "AIzaSyCzYT_q1bQRgrUeHMVSBxBBVMaRVOK8ZNw",  
    authDomain: "devamara-etc.firebaseapp.com",  
    projectId: "devamara-etc",  
    storageBucket: "devamara-etc.firebasestorage.app",  
    messagingSenderId: "876394714975",  
    appId: "1:876394714975:web:14b793f7122abdc24ec8ea"  
};  
firebase.initializeApp(firebaseConfig);  
const db = firebase.firestore();  
  
let characters = [];  
let popupResolve;  
  
/* ---------------- 고유 코드 생성 */  
function generateUniqueCode() {  
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";  
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";  
  
    const first = letters[Math.floor(Math.random() * 26)]  
                + letters[Math.floor(Math.random() * 26)];  
  
    const block = () =>  
        Array.from({ length: 4 })  
             .map(() => chars[Math.floor(Math.random() * chars.length)])  
             .join("");  
  
    return `${first}-${block()}-${block()}`;  
}  
  
/* ---------------- 팝업 ---------------- */  
function showPopup(message) {  
    return new Promise(resolve => {  
        document.getElementById("popup-message").innerText = message;  
        document.getElementById("popup").style.display = "flex";  
        popupResolve = resolve;  
    });  
}  
document.getElementById("popup-ok").onclick = () => { document.getElementById("popup").style.display = "none"; popupResolve(true); };  
document.getElementById("popup-cancel").onclick = () => { document.getElementById("popup").style.display = "none"; popupResolve(false); };  
  
/* ---------------- 페이지 이동 ---------------- */  
function showPage(id) {  
    document.querySelectorAll(".page").forEach(p => p.style.display = "none");  
    document.getElementById(id).style.display = "block";  
}  
function goList() { showPage("page-list"); }  
  
/* ---------------- Firestore 실시간 구독 ---------------- */  
function subscribeCharactersRealtime() {  
    db.collection('characters').orderBy('createdAt', 'desc').onSnapshot(snapshot => {  
        characters = [];  
        snapshot.forEach(doc => {  
            const data = doc.data();  
            characters.push({  
                id: doc.id,  
                img: data.img || "",  
                name: data.name || "",  
                hp: data.hp || 10,  
                str: data.str || 10,  
                int: data.int || 10,  
                cha: data.cha || 10,  
                code: data.code || null  
            });  
        });  
        renderList();  
    });  
}  
  
/* ---------------- 리스트 출력 ---------------- */  
function renderList() {  
    const box = document.getElementById("characterContainer");  
    box.innerHTML = "";  
    characters.forEach((c,i)=>{  
        const div=document.createElement("div");  
        div.className="character-card";  
        div.innerHTML = `<img src="${c.img}" alt="${c.name}" onerror="this.src='https://via.placeholder.com/200x200?text=No+Image'"><div class="char-name">${c.name}</div>`;  
        div.onclick=()=>openDetail(i);  
        box.appendChild(div);  
    });  
}  
  
/* ---------------- 등록 ---------------- */  
document.getElementById("btn-register").onclick = ()=>{  
    document.getElementById("reg-img").value="";  
    document.getElementById("reg-name").value="";  
    document.getElementById("preview").style.display="none";  
    showPage("page-register");  
};  
document.getElementById("reg-img").addEventListener("input", e=>{  
    const url=e.target.value;  
    const prev=document.getElementById("preview");  
    prev.src=url;  
    prev.style.display=url?"block":"none";  
});  
document.getElementById("btn-submit").onclick=async ()=>{  
    const img=document.getElementById("reg-img").value.trim();  
    const name=document.getElementById("reg-name").value.trim();  
    if(!img||!name){await showPopup("누락된 항목이 있습니다."); return;}  
    const ok=await showPopup("등록 이후에는 수정이 불가능합니다. 등록하시겠습니까?");  
    if(!ok) return;  
    db.collection('characters').add({  
        img,  
        name,  
        hp:10,  
        str:10,  
        int:10,  
        cha:10,  
        code:null,  
        createdAt: firebase.firestore.FieldValue.serverTimestamp()  
    });  
    goList();  
};  
  
/* ---------------- 상세 페이지 ---------------- */  
function openDetail(i){  
    const c=characters[i];  
    if(!c) return;  
    document.getElementById("detail-card-img").src=c.img;  
    document.getElementById("detail-card-name").innerText=c.name;  
  
    document.getElementById("hp-bar").style.width=(c.hp/10*100)+"%";  
    document.getElementById("hp-val").innerText=`${c.hp}/10`;  
    document.getElementById("str-bar").style.width=(c.str/10*100)+"%";  
    document.getElementById("str-val").innerText=`${c.str}/10`;  
    document.getElementById("int-bar").style.width=(c.int/10*100)+"%";  
    document.getElementById("int-val").innerText=`${c.int}/10`;  
    document.getElementById("cha-bar").style.width=(c.cha/10*100)+"%";  
    document.getElementById("cha-val").innerText=`${c.cha}/10`;  
  
    const codeBox=document.getElementById("detail-card-code");  
    let codeValue;  
    if(c.code){codeValue=c.code;}   
    else{codeValue=generateUniqueCode(); db.collection("characters").doc(c.id).update({code:codeValue});}  
    codeBox.innerText=codeValue;  
  
    JsBarcode("#detail-barcode", codeValue,{format:"CODE128", width:1.2,height:30,displayValue:false});  
  
    document.getElementById("btn-delete").onclick=async()=>{  
        const ok=await showPopup("삭제된 데이터는 복구가 불가능합니다. 삭제하시겠습니까?");  
        if(!ok) return;  
        db.collection('characters').doc(c.id).delete();  
        goList();  
    };  
  
    showPage("page-detail");  
}  
  
/* 시작 */  
subscribeCharactersRealtime();  
renderList();  
</script>  
</body>  
  
<!-- 페이지 하단 footer -->  
<footer>  
</footer>  
</html>
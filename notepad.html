<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
 <!-- 매니페스트 -->
<link rel="manifest" href="https://quitandquiet.github.io/devamara/etc/manifest_notepad.json" />
  
<title>메모장</title>

<!-- Galmuri 폰트 로드 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/galmuri/dist/galmuri.css"/>
<!-- hbios-sys 폰트 로드 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/quiple/hbios-sys@latest/hbios-sys.css">
<!-- Silver 폰트 로드 -->
<link rel="stylesheet" href="https://quitandquiet.github.io/devamara/etc/Silver_font.css"/>

<style>
/* 기본 컬러/폰트 */
:root{
  --win-bg: #12a692;
  --window-bg: #ececec;
  --titlebar: #000080;
  --menu-bg: #e5e5e5;
  --content-bg: #ffffff;
}
html,body{ height:100%; margin:0; background:var(--win-bg);
  /* Galmuri 계열 우선 지정 — 브라우저가 못 불러오면 sans-serif로 대체 */
  font-family: 'Galmuri9','Galmuri11', sans-serif;
  letter-spacing:-0.5px;
  -webkit-font-smoothing:antialiased;
}

/* 중앙 고정 창 (이전 크기 규격 사용) */
.notepad {
  position: fixed;
  width: min(860px, 92%);
  height: min(620px, 86%);
  left:50%; top:50%; transform:translate(-50%,-50%);
  background: var(--window-bg);
  border: 2px solid #000;
  display:flex; flex-direction:column; overflow:hidden;
  border-radius:4px;
}

/* 타이틀 바 */
.titlebar {
  height:32px; background:var(--titlebar); color:#fff;
  display:flex; align-items:center; gap:8px; padding:0 8px;
  font-size:14px; user-select:none;
}
.titlebar img{ width:18px; height:18px; margin-right:6px; }
.titlebar .buttons{ margin-left:auto; display:flex; gap:6px; }
.title-btn{ width:20px; height:20px; background:#c0c0c0; border:2px solid #808080; text-align:center; padding-top:3px line-height:15px; cursor:pointer; }

/* 메뉴바 */
.menubar {
  height:26px; background:var(--menu-bg);
  display:flex; align-items:center; gap:10px; padding-left:8px;
  border-bottom:1px solid #bbb; z-index:20;
}
.menu-item {
  position:relative; padding:3px 6px; cursor:pointer; font-size:14px;
}
.menu-item:hover{ background:#000080; color:#fff; }

/* 각 메뉴 내부에 드롭다운을 둠 — 위치는 메뉴 아이템을 기준으로 절대 배치 */
.menu-item .dropdown {
  position:absolute;
  top:100%; left:0;
  color: #000;
  background:#ebebeb; border:1px solid #000;
  min-width:170px; display:none; flex-direction:column;
  z-index:40;
}
.menu-item .dropdown .item{
  padding:6px 10px; white-space:nowrap; cursor:pointer;
}
.menu-item .dropdown .item:hover{ background:#bbb; color:#000; }

/* 글꼴 서브드롭다운 (format 메뉴 안에서 오른쪽으로 열림) */
.menu-item .dropdown .font-sub {
  position:absolute;
  top:0; left:100%;
  min-width:220px;
  display:none;
  background:#fff; border:1px solid #000;
  z-index:45;
  padding:8px;
}

/* 폰트 셀렉트 */
.font-sub select{ width:100%; padding:6px; font-size:14px; }

/* 에디터 영역 (전체를 입력란으로 사용) */
.content { flex:1; background:var(--content-bg); padding:10px; overflow:auto; }
#editor {
  width:100%; height:100%; outline:none; border:none;
  font-size:15px; line-height:1.6;
  /* 기본 폰트들 중 가능한 것으로 지정 */
  font-family: 'Galmuri9','Galmuri11', sans-serif;
  text-align:justify; white-space:pre-wrap; word-break:break-word;
}
</style>
</head>
<body>

<!-- Notepad window -->
<div class="notepad" role="dialog" aria-label="메모장">

  <!-- 타이틀 -->
  <div class="titlebar">
    <img src="https://cdn2.steamgriddb.com/icon/2b515e2bdd63b7f034269ad747c93a42/4/512x512.png" alt="아이콘">
    <div>메모장</div>
    <div class="buttons" aria-hidden="true">
      <div class="title-btn" id="minBtn">─</div>
      <div class="title-btn" id="maxBtn">▢</div>
      <div class="title-btn" id="closeBtn">✕</div>
    </div>
  </div>

  <!-- 메뉴바: 각 메뉴 항목 내부에 드롭다운 포함 -->
  <div class="menubar" role="menubar">
    <div class="menu-item" data-menu="file">파일
      <div class="dropdown" data-dropdown="file">
        <div class="item">새로 만들기</div>
        <div class="item">열기</div>
        <div class="item">저장</div>
        <div class="item">다른 이름으로 저장</div>
        <div class="item">끝내기</div>
      </div>
    </div>

    <div class="menu-item" data-menu="edit">편집
      <div class="dropdown" data-dropdown="edit">
        <div class="item">실행 취소</div>
        <div class="item">잘라내기</div>
        <div class="item">복사</div>
        <div class="item">붙여넣기</div>
        <div class="item">삭제</div>
        <div class="item">찾기</div>
        <div class="item">바꾸기</div>
        <div class="item">모두 선택</div>
      </div>
    </div>

    <div class="menu-item" data-menu="format">서식
      <div class="dropdown" data-dropdown="format">
        <div class="item">자동 줄 바꿈</div>
        <div class="item" id="fontItem">글꼴 ▸
          <!-- font-sub은 format dropdown 내부에서 오른쪽으로 열림 -->
          <div class="font-sub" id="fontSub">
            <label style="display:block;margin-bottom:6px;font-size:13px;color:#222;">글꼴 선택</label>
            <select id="fontSelect" aria-label="글꼴 선택"></select>
          </div>
        </div>
      </div>
    </div>

    <div class="menu-item" data-menu="view">보기
      <div class="dropdown" data-dropdown="view">
        <div class="item" id="statusToggle">상태 표시줄</div>
      </div>
    </div>

    <div class="menu-item" data-menu="help">도움말
      <div class="dropdown" data-dropdown="help">
        <div class="item" id="helpOpen">도움말 보기</div>
      </div>
    </div>
  </div>

  <!-- 에디터 (내용은 로컬에 저장) -->
  <div class="content">
    <div id="editor" contenteditable="true" spellcheck="true" aria-label="문서 편집 영역"></div>
  </div>

</div>

<script>
/* 간단 주석: 
 - 메뉴(.menu-item) 클릭 -> 내부 .dropdown 보이기
 - format > 글꼴은 내부 .font-sub (오른쪽으로 열림)
 - 에디터 내용은 localStorage에 자동 저장
*/

/* 로컬스토리지 키 */
const STORAGE_KEY = 'simple_notepad_content_v1';
const FONT_KEY = 'simple_notepad_font_v1';
const STATUS_KEY = 'simple_notepad_status_visible_v1';

/* DOM */
const editor = document.getElementById('editor');
const menuItems = document.querySelectorAll('.menu-item');
const helpOpen = document.getElementById('helpOpen');
const fontSelect = document.getElementById('fontSelect');
const fontSub = document.getElementById('fontSub');
const fontItem = document.getElementById('fontItem');

/* 초기 로드: 내용/폰트 */
editor.innerHTML = localStorage.getItem(STORAGE_KEY) || '';
const savedFont = localStorage.getItem(FONT_KEY) || 'Galmuri9';

/* 글꼴 목록 — Mono/Bold 계열 제외 */
const fonts = [
  "Galmuri7",
  "Galmuri9",
  "Galmuri11",
  "Galmuri14",
  "hbios-sys",
  "Silver"
];

/* 폰트 select 채우기 */
fonts.forEach(f=>{
  const opt = document.createElement('option');
  opt.value = f;
  opt.textContent = f;
  fontSelect.appendChild(opt);
});

/* 초기 폰트 적용 (저장값 또는 디폴트) */
function applyFont(name){
  // 에디터와 전체 notepad에 폰트 적용 (브라우저가 해당 폰트를 못불러오면 대체 폰트로 보임)
  editor.style.fontFamily = `"${name}", 'Galmuri9','Galmuri11', sans-serif`;
  document.documentElement.style.fontFamily = `"${name}", 'Galmuri9','Galmuri11', sans-serif`;
     if (name === "Silver") {
    editor.style.fontSize = "25px";
  } else {
    editor.style.fontSize = "15px";
     }
  localStorage.setItem(FONT_KEY, name);
}
applyFont(savedFont);
if(Array.from(fontSelect.options).some(o=>o.value===savedFont)) fontSelect.value = savedFont;

/* 자동 저장 (입력 후 600ms 지연 저장) */
let saveTimer = null;
editor.addEventListener('input', ()=>{
  if(saveTimer) clearTimeout(saveTimer);
  saveTimer = setTimeout(()=>{
    localStorage.setItem(STORAGE_KEY, editor.innerHTML);
    saveTimer = null;
  }, 600);
});

/* 메뉴 열기/닫기 로직
   - 메뉴 항목 내부의 .dropdown을 토글
   - 외부 클릭 시 닫힘 (요청: 드롭다운은 바깥을 클릭할 때만 닫힘)
*/
function closeAllDropdowns(){
  document.querySelectorAll('.menu-item .dropdown').forEach(dd=> dd.style.display='none');
  if(fontSub) fontSub.style.display='none';
}
document.addEventListener('click', (e)=>{
  // 외부 클릭이면 닫는다
  closeAllDropdowns();
});

/* 각 메뉴 클릭: 내부 dropdown 토글. 클릭 이벤트는 전파를 멈춤(그래야 document click에 의해 즉시 닫히지 않음) */
menuItems.forEach(mi=>{
  mi.addEventListener('click', (e)=>{
    e.stopPropagation();
    // 토글
    const dd = mi.querySelector('.dropdown');
    const shown = dd && dd.style.display === 'flex';
    // 먼저 모두 닫기
    closeAllDropdowns();
    if(dd && !shown){
      dd.style.display = 'flex';
    }
  });
  // 드롭다운 내부 클릭이 바깥으로 전파되어 닫히는 걸 막기 위해 내부 전파 차단
  const innerDd = mi.querySelector('.dropdown');
  if(innerDd) innerDd.addEventListener('click', (ev)=> ev.stopPropagation());
});

/* format>글꼴: 마우스 오버/클릭으로 fontSub 보이기 (클릭으로 토글) */
if(fontItem){
  fontItem.addEventListener('click', (e)=>{
    e.stopPropagation();
    // format.dropdown은 이미 열린 상태여야 함 — 우리가 토글 방식으로 하므로 처리
    const subShown = fontSub.style.display === 'block';
    // 닫고 다시 열기 방식 -> 우선 모든 닫기
    document.querySelectorAll('.menu-item .dropdown').forEach(dd=> dd.style.display='none');
    if(!subShown){
      // 먼저 format dropdown should be visible — make it visible and ensure fontSub visible
      const formatMenu = document.querySelector('.menu-item[data-menu="format"]');
      const formatDd = formatMenu && formatMenu.querySelector('.dropdown');
      if(formatDd) formatDd.style.display = 'flex';
      fontSub.style.display = 'block';
    } else {
      fontSub.style.display = 'none';
    }
  });
  // fontSub 내부 클릭 전파 차단
  fontSub.addEventListener('click', (ev)=> ev.stopPropagation());
}

/* fontSelect 변경 시 폰트 적용 */
fontSelect.addEventListener('change', (e)=>{
  applyFont(e.target.value);
});

/* 도움말 열기 (새 창) */
if(helpOpen){
  helpOpen.addEventListener('click', (e)=>{
    e.stopPropagation();
    window.open('https://youtu.be/fYXBGvdOFQE', '_blank', 'noopener');
    closeAllDropdowns();
  });
}

/* 타이틀 버튼 클릭 — 시각적 피드백만 (요청대로 동작 없음) */
['minBtn','maxBtn','closeBtn'].forEach(id=>{
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener('click', ()=>{
    el.style.transform = 'translateY(1px)';
    setTimeout(()=> el.style.transform = '', 120);
  });
});

/* 초기 완료: 드롭다운 닫힌 상태 유지, 폰트 선택값 맞춤 */
closeAllDropdowns();
if(fontSelect.value) fontSelect.value = localStorage.getItem(FONT_KEY) || fontSelect.value;
</script>

</body>
</html>
